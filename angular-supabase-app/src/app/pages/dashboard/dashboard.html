<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard - Gestión de Tareas</h1>
    <p>ABM completo con Supabase</p>
    <a routerLink="/inicio" class="btn btn-secondary">
      Volver al Inicio
    </a>
  </div>

  <!-- Configuración de Supabase -->
  <div class="config-notice">
    <h3>⚠️ Configuración requerida</h3>
    <p>Para usar Supabase, actualiza las credenciales en <code>src/app/services/supabase.service.ts</code></p>
    <ol>
      <li>Crea una cuenta en <a href="https://supabase.com" target="_blank">Supabase</a></li>
      <li>Crea un nuevo proyecto</li>
      <li>Ejecuta este SQL en el SQL Editor:</li>
    </ol>
    <pre><code>CREATE TABLE tasks (
  id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  completed BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Habilitar RLS (Row Level Security)
ALTER TABLE tasks ENABLE ROW LEVEL SECURITY;

-- Crear política para permitir todas las operaciones
CREATE POLICY "Enable all operations for tasks" ON tasks
FOR ALL USING (true) WITH CHECK (true);</code></pre>
  </div>

  <!-- Formulario para agregar nueva tarea -->
  <div class="form-section">
    <h2>Agregar Nueva Tarea</h2>
    <form (ngSubmit)="onSubmit()" #taskForm="ngForm" class="task-form">
      <div class="form-group">
        <label for="title">Título:</label>
        <input 
          type="text" 
          id="title"
          name="title"
          [(ngModel)]="newTask.title"
          required
          minlength="3"
          #title="ngModel"
          class="form-control"
          placeholder="Ingresa el título de la tarea">
        <div *ngIf="title.invalid && title.touched" class="error-message">
          El título es requerido y debe tener al menos 3 caracteres.
        </div>
      </div>

      <div class="form-group">
        <label for="description">Descripción:</label>
        <textarea 
          id="description"
          name="description"
          [(ngModel)]="newTask.description"
          required
          minlength="5"
          #description="ngModel"
          class="form-control"
          rows="3"
          placeholder="Describe la tarea"></textarea>
        <div *ngIf="description.invalid && description.touched" class="error-message">
          La descripción es requerida y debe tener al menos 5 caracteres.
        </div>
      </div>

      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="taskForm.invalid || isSubmitting">
        {{ isSubmitting ? 'Creando...' : 'Crear Tarea' }}
      </button>
    </form>
  </div>

  <!-- Estado de carga y errores -->
  <div *ngIf="loading" class="loading">
    Cargando tareas...
  </div>

  <div *ngIf="error" class="error">
    {{ error }}
  </div>

  <!-- Lista de tareas -->
  <div *ngIf="!loading" class="tasks-section">
    <div class="tasks-stats">
      <div class="stat-card">
        <h3>{{ tasks.length }}</h3>
        <p>Total de tareas</p>
      </div>
      <div class="stat-card">
        <h3>{{ pendingTasks.length }}</h3>
        <p>Pendientes</p>
      </div>
      <div class="stat-card">
        <h3>{{ completedTasks.length }}</h3>
        <p>Completadas</p>
      </div>
    </div>

    <div *ngIf="tasks.length === 0 && !error" class="no-tasks">
      <h3>No hay tareas aún</h3>
      <p>Agrega tu primera tarea usando el formulario anterior.</p>
    </div>

    <div *ngIf="tasks.length > 0" class="tasks-list">
      <h2>Mis Tareas</h2>
      <div class="tasks-container">
        <app-task-item
          *ngFor="let task of tasks"
          [task]="task"
          (deleteTask)="onDeleteTask($event)"
          (toggleComplete)="onToggleComplete($event)">
        </app-task-item>
      </div>
    </div>
  </div>
</div>
